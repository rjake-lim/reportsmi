<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Responsive Bootstrap Dashboard</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
    font-family: Arial, sans-serif;
    background-color: #F0F4F8;
}
.sidebar {
    background-color: #4CAF50;
    color: white;
    height: 100vh;
    padding-top: 20px;
}
.sidebar a {
    display: block;
    color: white;
    text-decoration: none;
    padding: 10px 20px;
    transition: background 0.3s;
    border-radius: 5px;
}
.sidebar a:hover {
    background-color: #388E3C;
}
.card-custom {
    background-color: #81C784;
    color: white;
    border-radius: 8px;
}
.alert-custom {
    background-color: #FFC107;
    color: #333;
}
td {
    min-width: 150px;
    cursor: text;
}
td:focus {
    outline: 2px solid #0d6efd;
}
#outputText {
    min-height: 300px;
    white-space: pre-wrap;
    background: #f8f9fa;
    padding: 15px;
    border-radius: 6px;
    border: 1px solid #dee2e6;
}
</style>
</head>
<body>

<nav class="navbar navbar-light bg-white shadow-sm px-4">
<button class="btn btn-outline-success d-md-none me-3"
data-bs-toggle="collapse"
data-bs-target="#sidebarMenu">
â˜°
</button>
<a class="navbar-brand d-flex align-items-center">
<img src="https://upload.wikimedia.org/wikipedia/commons/4/48/Mang_Inasal.svg" height="60">
<span class="fs-4 text-dark ms-3">Dashboard</span>
</a>
</nav>

<div class="container-fluid">
<div class="row">

<nav id="sidebarMenu" class="col-md-2 collapse d-md-block sidebar">
<h5 class="px-3">Menu</h5>
<a href="#">Dashboard</a>
<a href="#">Analytics</a>
<a href="#" onclick="openReports()">Reports</a>
<a href="#">Settings</a>
</nav>

<main class="col-md-10 ms-sm-auto px-4">

<div class="row my-4">
<div class="col-md-4 mb-3">
<div class="card card-custom p-3 text-center">
<h5>Users</h5>
<p class="fs-4">1,234</p>
</div>
</div>
<div class="col-md-4 mb-3">
<div class="card card-custom p-3 text-center">
<h5>Revenue</h5>
<p class="fs-4">$12,345</p>
</div>
</div>
<div class="col-md-4 mb-3">
<div class="card card-custom p-3 text-center">
<h5>Sales</h5>
<p class="fs-4">567</p>
</div>
</div>
</div>

<div class="alert alert-custom my-3">Server load is high!</div>

<h4 class="mt-4">Excel-like Editable Table</h4>

<div class="row">
<div class="col-md-6 mb-3">
<table class="table table-bordered" id="editableTable">
<tbody>
<tr><td contenteditable="true"></td></tr>
</tbody>
</table>
</div>

<div class="col-md-6 mb-3">
<div id="outputText" contenteditable="true"></div>
<button class="btn btn-success mt-2" id="saveBtn" onclick="saveOrUpdateReport()">Save Report</button>
</div>
</div>

</main>
</div>
</div>

<!-- REPORTS MODAL -->
<div class="modal fade" id="reportsModal">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h5>Saved Reports</h5>
<button class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<table class="table">
<thead>
<tr><th>Date</th><th>Actions</th></tr>
</thead>
<tbody id="reportsList"></tbody>
</table>
</div>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBCpZCNOmT0hcuTdJmU_3-SA4rTv5k4PpY",
  authDomain: "reportsmi-3181.firebaseapp.com",
  projectId: "reportsmi-3181",
  storageBucket: "reportsmi-3181.firebasestorage.app",
  messagingSenderId: "276935335804",
  appId: "1:276935335804:web:28b70982f495fca48fcef9"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let currentReportID = null;

const table = document.getElementById("editableTable");
const tbody = table.querySelector("tbody");
const output = document.getElementById("outputText");
const saveBtn = document.getElementById("saveBtn");

// Update output text from table
function updateText() {
    let text = "";
    tbody.querySelectorAll("tr").forEach(row=>{
        let rowText="";
        row.querySelectorAll("td").forEach((cell,index)=>{
            if(index>0) rowText+=" ";
            rowText+=cell.innerText;
        });
        text+=rowText+"\n";
    });
    output.innerText = text;
}
table.addEventListener("input", updateText);

// Paste support
table.addEventListener("paste", e=>{
    let text = e.clipboardData.getData("text");
    if(text.includes("\t") || text.includes("\n")){
        e.preventDefault();
        const rows = text.replace(/\r/g,"").split("\n").map(r=>r.split("\t"));
        tbody.innerHTML="";
        rows.forEach(row=>{
            const tr = document.createElement("tr");
            row.forEach(cell=>{
                const td = document.createElement("td");
                td.contentEditable=true;
                td.innerText=cell;
                tr.appendChild(td);
            });
            tbody.appendChild(tr);
        });
        updateText();
    }
});

// Save or update
function saveOrUpdateReport() {
    const text = output.innerText.trim();
    if(!text){ alert("Nothing to save"); return; }

    if(currentReportID){
        db.collection("reports").doc(currentReportID).update({
            text:text,
            date: firebase.firestore.FieldValue.serverTimestamp()
        }).then(()=>{
            alert("Updated Successfully");
            saveBtn.innerText="Save Report";
            currentReportID=null;
        });
    } else {
        db.collection("reports").add({
            text:text,
            date: firebase.firestore.FieldValue.serverTimestamp()
        }).then(()=>{
            alert("Saved Successfully");
        });
    }
}

// Open reports modal
function openReports(){
    loadReports();
    new bootstrap.Modal(document.getElementById("reportsModal")).show();
}

// Load all reports
function loadReports(){
    const list = document.getElementById("reportsList");
    list.innerHTML="";
    db.collection("reports").orderBy("date","desc").get().then(snapshot=>{
        snapshot.forEach(doc=>{
            const data = doc.data();
            const dateStr = data.date ? data.date.toDate().toLocaleString() : "Unknown";
            const tr = document.createElement("tr");
            tr.innerHTML = `
            <td>${dateStr}</td>
            <td>
                <button class="btn btn-primary btn-sm" onclick="loadReport('${doc.id}')">Open</button>
                <button class="btn btn-danger btn-sm" onclick="deleteReport('${doc.id}')">Delete</button>
            </td>`;
            list.appendChild(tr);
        });
    });
}

// Load report into main dashboard
function loadReport(id){
    db.collection("reports").doc(id).get().then(doc=>{
        const data = doc.data();
        if(!data || !data.text) return;

        // Build table from saved text
        tbody.innerHTML="";
        const rows = data.text.trim().split("\n");
        rows.forEach(r=>{
            const tr = document.createElement("tr");
            r.split(" ").forEach(c=>{
                const td = document.createElement("td");
                td.contentEditable=true;
                td.innerText=c;
                tr.appendChild(td);
            });
            tbody.appendChild(tr);
        });

        currentReportID = id;
        updateText();
        saveBtn.innerText="Update Report"; // change button text
        alert("Report loaded! Make edits and click Update Report.");
    });

    // Close modal
    const modal = bootstrap.Modal.getInstance(document.getElementById("reportsModal"));
    if(modal) modal.hide();
}

// Delete report
function deleteReport(id){
    if(confirm("Are you sure you want to delete this report?")){
        db.collection("reports").doc(id).delete().then(()=>{
            alert("Deleted Successfully");
            loadReports();
            if(currentReportID===id){
                tbody.innerHTML='<tr><td contenteditable="true"></td></tr>';
                output.innerText="";
                saveBtn.innerText="Save Report";
                currentReportID=null;
            }
        });
    }
}
</script>
</body>
</html>
