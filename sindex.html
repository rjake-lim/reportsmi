<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MI Reports System</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
    font-family: Arial, sans-serif;
    background-color: #F0F4F8;
    margin:0;
    padding:0;
    overflow-x: hidden;
}

/* NAVBAR */
.navbar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 1030;
}

/* SIDEBAR */
.sidebar {
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    width: 260px;
    background: linear-gradient(180deg,#2e7d32,#1b5e20);
    color: white;
    transition: transform .3s ease;
    z-index: 1050;
    padding-top: 60px; /* navbar height */
    box-shadow: 4px 0 15px rgba(0,0,0,0.2);
    transform: translateX(-100%);
}
.sidebar.show {
    transform: translateX(0);
}
.sidebar a {
    display: block;
    color: white;
    text-decoration: none;
    padding: 12px 20px;
    margin: 5px 10px;
    border-radius: 8px;
    font-weight: 500;
}
.sidebar a:hover {
    background: rgba(255,255,255,0.15);
}
.sidebar-close {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 22px;
    cursor: pointer;
    display: block;
}

/* OVERLAY */
.overlay {
    position: fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background: rgba(0,0,0,0.4);
    opacity:0;
    visibility:hidden;
    transition: .3s;
    z-index: 1040;
}
.overlay.show {
    opacity:1;
    visibility:visible;
}

/* CONTENT WRAPPER */
.content-wrapper {
    transition:.3s;
    padding: 80px 20px 20px 20px;
    margin-left: 0;
}
.content-wrapper.shift {
    margin-left: 260px;
}

/* CARDS */
.card-custom {
    background-color: #2e7d32;
    color: white;
    border-radius: 8px;
}

/* ALERTS */
.alert-custom {
    background-color: #FFC107;
    color: #333;
}

/* EXCEL-LIKE TABLE */
td {
    min-width: 150px;
    cursor: text;
}
td:focus {
    outline: 2px solid #0d6efd;
}
#outputText {
    min-height: 300px;
    white-space: pre-wrap;
    background: #fff;
    padding: 15px;
    border-radius: 6px;
    border: 1px solid #dee2e6;
}
</style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-light bg-white shadow-sm px-4">
<button id="menuToggle" class="btn btn-success">
☰
</button>
<span class="fs-4 ms-3">MI Reports System</span>
</nav>

<!-- SIDEBAR -->
<div id="sidebarMenu" class="sidebar">
<div id="sidebarClose" class="sidebar-close">✕</div>
<h5 class="px-3">Menu</h5>
<a href="#" onclick="showDashboard()">Dashboard</a>
<a href="#" onclick="showAnalytics()">Analytics</a>
<a href="#" onclick="showReports()">Reports</a>
<a href="#" onclick="showSettings()">Settings</a>
</div>

<div id="overlay" class="overlay"></div>

<!-- CONTENT -->
<div class="content-wrapper" id="contentWrapper">
<div class="container-fluid">

<!-- DASHBOARD PAGE -->
<div id="dashboardPage">
<div class="row my-4">
    <div class="col-md-4 mb-3">
        <div class="card card-custom p-3 text-center">
            <h5>Users</h5>
            <p class="fs-4">1,234</p>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="card card-custom p-3 text-center">
            <h5>Revenue</h5>
            <p class="fs-4">$12,345</p>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="card card-custom p-3 text-center">
            <h5>Sales</h5>
            <p class="fs-4">567</p>
        </div>
    </div>
</div>

<div class="alert alert-custom my-3">Server load is high!</div>

<h4 class="mt-4">Excel-like Editable Table</h4>
<div class="row">
<div class="col-md-6 mb-3">
<table class="table table-bordered" id="editableTable">
<tbody>
<tr><td contenteditable="true"></td></tr>
</tbody>
</table>
</div>
<div class="col-md-6 mb-3">
<div id="outputText" contenteditable="true"></div>
</div>
</div>
<button class="btn btn-success mb-3" onclick="saveReport()" id="saveBtn">Save Report</button>
<button class="btn btn-warning mb-3" onclick="updateReport()" id="updateBtn" style="display:none;">Update Report</button>
</div>

<!-- REPORTS PAGE -->
<div id="reportsPage" style="display:none;">
<h4>Saved Reports</h4>
<table class="table table-bordered">
<thead>
<tr>
<th>Date</th>
<th>Action</th>
</tr>
</thead>
<tbody id="reportsTable"></tbody>
</table>
</div>

<!-- ANALYTICS PAGE -->
<div id="analyticsPage" style="display:none;">
<h4>Analytics</h4>
<p>Analytics content goes here...</p>
</div>

<!-- SETTINGS PAGE -->
<div id="settingsPage" style="display:none;">
<h4>Settings</h4>
<p>Settings content goes here...</p>
</div>

</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, doc, getDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBCpZCNOmT0hcuTdJmU_3-SA4rTv5k4PpY",
  authDomain: "reportsmi-3181.firebaseapp.com",
  projectId: "reportsmi-3181",
  storageBucket: "reportsmi-3181.firebasestorage.app",
  messagingSenderId: "276935335804",
  appId: "1:276935335804:web:28b70982f495fca48fcef9"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
let currentReportID = null;

// Save Report
window.saveReport = async () => {
    const text = outputText.innerText;
    await addDoc(collection(db,"reports"),{ content:text, date:new Date().toLocaleString() });
    alert("Report Saved");
}

// Update Report
window.updateReport = async () => {
    await updateDoc(doc(db,"reports",currentReportID),{ content:outputText.innerText });
    alert("Report Updated");
}

// Show Dashboard
window.showDashboard = () => {
    dashboardPage.style.display="block";
    reportsPage.style.display="none";
    analyticsPage.style.display="none";
    settingsPage.style.display="none";
    saveBtn.style.display="inline-block";
    updateBtn.style.display="none";
}

// Show Reports
window.showReports = async () => {
    dashboardPage.style.display="none";
    reportsPage.style.display="block";
    analyticsPage.style.display="none";
    settingsPage.style.display="none";

    const snapshot = await getDocs(collection(db,"reports"));
    reportsTable.innerHTML = "";
    snapshot.forEach(docSnap=>{
        reportsTable.innerHTML += `
        <tr>
        <td>${docSnap.data().date}</td>
        <td>
            <button class="btn btn-info btn-sm" onclick="openReport('${docSnap.id}')">Open</button>
            <button class="btn btn-danger btn-sm" onclick="deleteReport('${docSnap.id}')">Delete</button>
        </td>
        </tr>
        `;
    });
}

// Open Report
window.openReport = async (id)=>{
    const snap = await getDoc(doc(db,"reports",id));
    outputText.innerText = snap.data().content;
    currentReportID = id;
    showDashboard();
    saveBtn.style.display="none";
    updateBtn.style.display="inline-block";
}

// Delete Report
window.deleteReport = async (id)=>{
    if(confirm("Delete this report?")){
        await deleteDoc(doc(db,"reports",id));
        showReports();
    }
}

// Analytics
window.showAnalytics = () => {
    dashboardPage.style.display="none";
    reportsPage.style.display="none";
    analyticsPage.style.display="block";
    settingsPage.style.display="none";
}

// Settings
window.showSettings = () => {
    dashboardPage.style.display="none";
    reportsPage.style.display="none";
    analyticsPage.style.display="none";
    settingsPage.style.display="block";
}
</script>

<!-- EXCEL TABLE -->
<script>
const table = document.getElementById("editableTable");
const tbody = table.querySelector("tbody");
const output = document.getElementById("outputText");

// Convert table to plain text
function updateText() {
    let text = "";
    tbody.querySelectorAll("tr").forEach(row => {
        let rowText = "";
        row.querySelectorAll("td").forEach((cell,index)=>{
            let cellText = cell.innerText.replace(/\t/g,"");
            if(index>0) rowText += " ";
            rowText += cellText;
        });
        text += rowText + "\n";
    });
    output.textContent = text;
}

// Keep one empty row
function ensureEmptyRow() {
    const rows = tbody.querySelectorAll("tr");
    const lastRow = rows[rows.length-1];
    const hasContent = [...lastRow.cells].some(td=>td.innerText.trim()!=="");
    if(hasContent){
        const tr = document.createElement("tr");
        for(let i=0;i<lastRow.cells.length;i++){
            const td = document.createElement("td");
            td.contentEditable="true";
            tr.appendChild(td);
        }
        tbody.appendChild(tr);
    }
}

// Arrow key navigation
table.addEventListener("keydown", e => {
    const cell = e.target.closest("td");
    if(!cell) return;
    const row = cell.parentElement;
    const rowIndex = [...tbody.rows].indexOf(row);
    const colIndex = [...row.cells].indexOf(cell);
    let targetCell = null;
    switch(e.key){
        case "ArrowRight": e.preventDefault();
            if(!row.cells[colIndex+1]){
                tbody.querySelectorAll("tr").forEach(r=>{
                    const td = document.createElement("td");
                    td.contentEditable = "true";
                    r.appendChild(td);
                });
            }
            targetCell = row.cells[colIndex+1];
            break;
        case "ArrowLeft": e.preventDefault(); targetCell = row.cells[colIndex-1]; break;
        case "ArrowDown": e.preventDefault();
            if(!tbody.rows[rowIndex+1]){
                const tr = document.createElement("tr");
                for(let i=0;i<row.cells.length;i++){
                    const td = document.createElement("td");
                    td.contentEditable = "true";
                    tr.appendChild(td);
                }
                tbody.appendChild(tr);
            }
            targetCell = tbody.rows[rowIndex+1].cells[colIndex];
            break;
        case "ArrowUp": e.preventDefault();
            if(tbody.rows[rowIndex-1]) targetCell = tbody.rows[rowIndex-1].cells[colIndex];
            break;
    }
    if(targetCell) targetCell.focus();
});

// Paste support
table.addEventListener("paste", e=>{
    const text = e.clipboardData.getData("text");
    if(text.includes("\t")||text.includes("\n")){
        e.preventDefault();
        const rows = text.replace(/\r/g,"").split("\n").map(r=>r.split("\t"));
        tbody.innerHTML="";
        rows.forEach(row=>{
            const tr=document.createElement("tr");
            row.forEach(cellText=>{
                const td=document.createElement("td");
                td.contentEditable="true";
                td.innerText=cellText;
                tr.appendChild(td);
            });
            tbody.appendChild(tr);
        });
    }
    ensureEmptyRow();
    updateText();
});

// Input update
table.addEventListener("input", ()=>{
    ensureEmptyRow();
    updateText();
});
</script>

<!-- SIDEBAR CONTROL -->
<script>
const sidebar=document.getElementById("sidebarMenu");
const overlay=document.getElementById("overlay");
const toggle=document.getElementById("menuToggle");
const closeBtn=document.getElementById("sidebarClose");
const contentWrapper=document.getElementById("contentWrapper");

toggle.onclick=()=>{
    sidebar.classList.add("show");
    overlay.classList.add("show");
    contentWrapper.classList.add("shift");
};

closeBtn.onclick=closeSidebar;
overlay.onclick=closeSidebar;

function closeSidebar(){
    sidebar.classList.remove("show");
    overlay.classList.remove("show");
    contentWrapper.classList.remove("shift");
}
</script>

</body>
</html>
